<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <title>Document</title>
</head>
<body>
    <nav id="nav"><a href="../html/home.html">Accueil</a></nav>

    <h1>Login</h1>

    <section class="container mt-5 mb-5">
        <h1 class="large text-primary">Sign In</h1>
        <p class="lead"><i class="fas fa-user"></i> Sign into Your Account</p>
        <form class="form" method="POST" action="/login">
            <div class="form-group">
                <input
                    type="email"
                    placeholder="Email Address"
                    name="email"
                    required
                />
            </div>
            <div class="form-group">
                <input type="password" placeholder="Password" name="password" />
            </div>
            <input type="submit" class="btn btn-primary" value="Login" />
        </form>
        <p class="my-1">Don't have an account? <a href="/register">Sign Up</a></p>
    </section>
    
    <!-- <script src="../js/nav.js"></script> -->
    <script>
        
        async function getLists () {
        try{
            const log = {
                email:"admin@gmail.com" ,
                password:"adminadmin"  
            }
          // récupération des listes
          const apiResponse = await fetch(`http://localhost:3000/login`, {
        method: 'POST', // on veut créer une ressource liste
        body: JSON.stringify(log), // les informations permettant au serveur de créer la liste (nom de la liste) sont encodée au format json dans le corp de la requête
        headers: { // on ajoute une entete à notre requête
          'Content-type': 'application/json', // qui permet de préciser que le corp de la requête est encodé en json (ce qui permettra au serveur de savoir comment la décoder)
        }
      });
    
        const data = await apiResponse.json();
        if (apiResponse.ok) {
            console.log(data.message);
        } else {
            console.error('Erreur d\'authentification:', data.error);
        }

        const userSession = await fetch(`http://localhost:3000/session`, {
        method:'GET',
        credentials: 'include'
        })

        const data2 = await userSession.json();
          console.log(data2);
          console.log(document.cookie.split(';').some((cookie) => cookie.trim().startsWith('connect.sid=')));
          
        }catch(error){
          alert("Une erreur inattendue s'est produite. Merci de revenir plus tard...");
        }
        };
        getLists();
  
  </script>

</body>
</html>
</body>
</html>